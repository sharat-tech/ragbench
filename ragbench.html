<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ChatGPT-Like Interface</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      transition: background-color 0.3s ease;
    }

    aside {
      background: linear-gradient(to bottom, #f8fafc, #e2e8f0);
      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }

    aside:hover {
      transform: scale(1.02);
    }

    #send-button:hover, #button-only:hover {
      transform: translateY(-2px);
      box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
    }

    main {
      transition: all 0.3s ease;
    }

    main:hover {
      box-shadow: 0px 6px 10px rgba(0, 0, 0, 0.1);
    }

    .message {
      opacity: 0;
      animation: fadeIn 0.5s ease forwards;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
  </style>
</head>
<body class="bg-gray-100 h-screen flex">
  <aside class="w-1/4 p-4 space-y-4">
    <div class="space-y-4">
      <select id="dropdown" class="border rounded-lg p-2 w-full bg-white shadow-md hover:shadow-lg">
        <option value="hagrid">hagrid</option>
        <option value="covidqa">covidqa</option>
        <option value="emanual">emanual</option>
        <option value="hotpotqa">hotpotqa</option>
        <option value="msmarco">msmarco</option>
        <option value="pubmedqa">pubmedqa</option>
        <option value="expertqa">expertqa</option>
        <option value="cuad">cuad</option>
        <option value="delusionqa">delusionqa</option>
        <option value="techqa">techqa</option>
        <option value="finqa">finqa</option>
        <option value="tatqa">tatqa</option>
      </select>
      <input id="input-box" type="text" class="border rounded-lg p-2 w-full bg-white shadow-md hover:shadow-lg" placeholder="Type the question number.">
      <button id="send-button" class="bg-blue-500 text-white px-4 py-2 rounded-lg w-full hover:bg-blue-600">Send</button>
      <button id="button-only" class="bg-green-500 text-white px-4 py-2 rounded-lg w-full hover:bg-green-600">Random Question</button>
    </div>
  </aside>

  <div class="flex-1 overflow-y-auto p-4">
    <header class="bg-blue-500 text-white text-center py-4 text-xl font-bold mb-4 rounded-xl shadow">Ragbench Dataset</header>
    <main id="chat-window" class="bg-white rounded-2xl shadow-lg p-4 space-y-4 h-full">
      <!-- Messages will be appended here -->
    </main>
  </div>

  <script>
    const chatWindow = document.getElementById('chat-window');
    const dropdown = document.getElementById('dropdown');
    const inputBox = document.getElementById('input-box');
    const sendButton = document.getElementById('send-button');
    const buttonOnly = document.getElementById('button-only');

    function addMessage(role, text) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${role === 'user' ? 'text-right' : 'text-left'}`;
      messageDiv.innerHTML = `
        <div class="inline-block px-4 py-2 rounded-lg ${role === 'user' ? 'bg-blue-500 text-white' : 'bg-gray-300'}">
          ${text}
        </div>
      `;
      chatWindow.appendChild(messageDiv);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    async function callApi() {
    const apiUrl = 'http://127.0.0.1:8000/getRandomQuestion';
    try {
        const response = await fetch(apiUrl, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        
        const result = await response.json();
        return result;
    } catch (error) {
        console.error('Error calling API:', error);
        return { error: 'Failed to fetch result' };
    }
}

async function callApiforDataset(params) {
    const apiUrl = 'http://127.0.0.1:8000/search?datasetName='+params.option+'&questionIndex='+params.message;
    


    try {
        const response = await fetch(apiUrl, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        
        const result = await response.json();
        return result;
    } catch (error) {
        console.error('Error calling API:', error);
        return { error: 'Failed to fetch result' };
    }
}

    sendButton.addEventListener('click', async () => {
      const dropdownValue = dropdown.value;
      const inputValue = inputBox.value;

      if (!inputValue.trim()) return;

      addMessage('user', "<b>Selected Dataset :</b>"+dropdownValue+" <br> <b>Question index is: </b>"+inputValue );
      inputBox.value = '';

      const apiResponse = await callApiforDataset({ option: dropdownValue, message: inputValue });
      const messageToPass =  "<b>Question in index is: </b>"+apiResponse.question+ "<br><b> Answer from RAG:</b> "+apiResponse.answer + " <br> <b>Original answer from dataset:</b> "+apiResponse.orginalanswer;
      addMessage('bot',  messageToPass || apiResponse.error);
    });

    buttonOnly.addEventListener('click', async () => {
      addMessage('user', 'Randomly Pick a Question');

      const apiResponse = await callApi({ action: 'button-only' });
      const messageToPass = "<b>Picked Question is from the dataset :</b>"+apiResponse.datasetName+" <br><b> Question is: </b>"+apiResponse.question + " <br> <b>Answer from RAG:</b> "+apiResponse.answer + " <br> <b>Original answer from dataset: </b>"+apiResponse.orginalanswer;
      addMessage('bot',  messageToPass || apiResponse.error);
    });
  </script>
</body>
</html>
